(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{285:(e,t,s)=>{"use strict";s.d(t,{$:()=>d});var r=s(5155),i=s(2115),n=s(4253),a=s(2085),o=s(9434);let l=(0,a.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=i.forwardRef((e,t)=>{let{className:s,variant:i,size:a,asChild:d=!1,...c}=e,u=d?n.DX:"button";return(0,r.jsx)(u,{className:(0,o.cn)(l({variant:i,size:a,className:s})),ref:t,...c})});d.displayName="Button"},1856:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>B});var r=s(5155),i=s(2115),n=s(5695),a=s(9576),o=s(9298),l=s(285),d=s(6695),c=s(3262),u=s(9434),m=s(7481);function f(e){let{title:t,description:s,onSubmit:n}=e,[a,o]=(0,i.useState)(null),{toast:c}=(0,m.dj)();return(0,r.jsxs)(d.Zp,{className:"shadow-lg animate-in fade-in-50 duration-500",children:[(0,r.jsxs)(d.aR,{children:[(0,r.jsx)(d.ZB,{className:"font-headline text-center",children:t}),(0,r.jsx)(d.BT,{className:"text-center",children:s})]}),(0,r.jsx)(d.Wu,{children:(0,r.jsx)("div",{className:"flex justify-center gap-2 md:gap-4",children:[1,2,3,4,5].map(e=>(0,r.jsx)(l.$,{variant:"outline",size:"icon",className:(0,u.cn)("h-12 w-12 rounded-full text-lg font-bold transition-all duration-200",a===e?"bg-accent text-accent-foreground scale-110":"bg-background"),onClick:()=>o(e),children:e},e))})}),(0,r.jsx)(d.wL,{children:(0,r.jsx)(l.$,{className:"w-full",onClick:()=>{if(null===a)return void c({title:"Selection required",description:"Please select a stress level before submitting.",variant:"destructive"});n(a)},children:"Submit"})})]})}function h(e){let{affirmation:t,onContinue:s}=e;return(0,r.jsxs)(d.Zp,{className:"shadow-lg text-center animate-in fade-in-50 duration-500",children:[(0,r.jsxs)(d.aR,{children:[(0,r.jsx)(d.ZB,{className:"font-headline",children:"Your Affirmation"}),(0,r.jsx)(d.BT,{children:"Take a moment to read and reflect."})]}),(0,r.jsx)(d.Wu,{children:(0,r.jsx)("p",{className:"text-2xl font-semibold font-headline text-accent-foreground leading-relaxed",children:t})}),(0,r.jsx)(d.wL,{children:(0,r.jsxs)(l.$,{className:"w-full",onClick:s,children:["Continue ",(0,r.jsx)(c.Qp,{className:"ml-2 h-4 w-4"})]})})]})}let g=["My child sees the world with clarity and honesty, reminding me to embrace truth and authenticity in all I do.","Parenting my child has made me more patient, compassionate, and understanding—not just as a parent, but as a person.","I have learned to focus on what I can control, creating a safe and loving environment where my child can thrive.","My child's sense of justice, kindness, and inclusion inspires me to be a better advocate for all.","Through my child's eyes, I see the beauty in the small victories—every milestone is a triumph worth celebrating.","I have gained strength, resilience, and a powerful voice by advocating for my child—and in doing so, I have learned to advocate for myself too.","The way my child experiences joy—through flapping their arms, jumping, and laughing—teaches me to embrace happiness in its purest form.","My child’s love for their passions is contagious, reminding me that curiosity and excitement are gifts to be cherished.","Because of my child, I see the world differently—not as it is expected to be, but as it truly is.","My child has taught me the power of communication beyond words—every gesture, every look, every sound is filled with meaning.","I no longer worry about the judgments of others. I focus on my child, their needs, their joy, and their incredible journey.","I am part of a wonderful community of parents who support, uplift, and inspire one another—this journey is never walked alone.","My child’s presence in my life is a privilege, a daily reminder that being different is not only okay—it is beautiful.","I am forever grateful for the lessons my child teaches me—patience, acceptance, and the courage to see the world in a new way."];var p=s(9672);let x=p.Kq,v=p.bL,y=p.l9,w=i.forwardRef((e,t)=>{let{className:s,sideOffset:i=4,...n}=e;return(0,r.jsx)(p.UC,{ref:t,sideOffset:i,className:(0,u.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...n})});w.displayName=p.UC.displayName;var j=s(5317),b=s(6104);async function N(e){console.log("Inside saveStressData:"),console.log("Data to be saved:",e);try{let t=await (0,j.gS)((0,j.rJ)(b.db,"stressData"),e);return console.log("Document written with ID: ",t.id),{success:!0,id:t.id}}catch(e){if(console.error("Error adding document: ",e),e instanceof Error)return{success:!1,error:e.message};return{success:!1,error:"Failed to save data"}}}var S=s(9229),k=s(4779);function T(){let{user:e}=(0,a.A)(),{toast:t}=(0,m.dj)(),[s,n]=(0,i.useState)("default"),[o,d]=(0,i.useState)(!1);(0,i.useEffect)(()=>{"Notification"in window&&(n(Notification.permission),"granted"===Notification.permission&&(0,k.$J)(e=>{var s,r;console.log("Received notification:",e),t({title:(null==(s=e.notification)?void 0:s.title)||"Notification",description:(null==(r=e.notification)?void 0:r.body)||""})}))},[]);let u=async()=>{if(e){if("granted"===s)return void t({title:"Notifications are enabled",description:"To disable, go to your browser settings → Site Settings → Notifications"});d(!0);try{let s=await (0,k.mT)();s?(await (0,k.Lx)(e.uid,s),n("granted"),t({title:"Notifications enabled!",description:"You will receive reminders for your daily affirmations."}),(0,k.$J)(e=>{var s,r;console.log("Received notification:",e),t({title:(null==(s=e.notification)?void 0:s.title)||"Notification",description:(null==(r=e.notification)?void 0:r.body)||""})})):(n("denied"),t({title:"Notifications blocked",description:"Please enable notifications in your browser settings.",variant:"destructive"}))}catch(e){console.error("Error toggling notifications:",e),t({title:"Error",description:"Failed to enable notifications. Please try again.",variant:"destructive"})}finally{d(!1)}}};if(!("Notification"in window))return null;let f="granted"===s,h="denied"===s;return(0,r.jsx)(x,{children:(0,r.jsxs)(v,{children:[(0,r.jsx)(y,{asChild:!0,children:(0,r.jsxs)(l.$,{variant:f?"default":"outline",size:"icon",onClick:u,disabled:o,className:h?"opacity-50":"",children:[f?(0,r.jsx)(c.Ir,{className:"h-4 w-4"}):(0,r.jsx)(c.br,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:f?"Notifications enabled":"Enable notifications"})]})}),(0,r.jsx)(w,{children:(0,r.jsx)("p",{children:f?"Notifications are enabled":h?"Notifications blocked - check browser settings":"Click to enable notifications"})})]})})}let C=()=>{let e=window.navigator.userAgent.toLowerCase();return/iphone|ipad|ipod/.test(e)},E=()=>!!(window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone||document.referrer.includes("android-app://"));function I(){let{toast:e}=(0,m.dj)(),[t,s]=(0,i.useState)(null),[n,a]=(0,i.useState)(!1),[o,d]=(0,i.useState)(!1),[u,f]=(0,i.useState)(null);(0,i.useEffect)(()=>{if(E())return void a(!0);C()?(f("ios"),d(!0)):f("other");let e=e=>{e.preventDefault(),s(e),d(!0),console.log("PWA install prompt available")},t=()=>{console.log("PWA was installed"),a(!0),d(!1),s(null)};return window.addEventListener("beforeinstallprompt",e),window.addEventListener("appinstalled",t),()=>{window.removeEventListener("beforeinstallprompt",e),window.removeEventListener("appinstalled",t)}},[]);let h=async()=>{if("ios"===u)e({title:"Install on iOS",description:'1. Tap the Share button (⬆️)\n2. Scroll and tap "Add to Home Screen"\n3. Tap "Add"',duration:1e4});else if(t)try{await t.prompt();let r=await t.userChoice;"accepted"===r.outcome?(console.log("User accepted the install prompt"),a(!0),e({title:"App installed!",description:"BRAIN KIT has been added to your home screen."})):console.log("User dismissed the install prompt"),s(null)}catch(e){console.error("Error showing install prompt:",e)}else e({title:"Install via browser menu",description:"Use your browser's menu to install this app to your home screen.",duration:5e3})};return n||!o?null:(0,r.jsx)(x,{children:(0,r.jsxs)(v,{children:[(0,r.jsx)(y,{asChild:!0,children:(0,r.jsxs)(l.$,{onClick:h,size:"lg",className:"fixed bottom-6 right-6 rounded-full shadow-lg h-14 w-14 z-50",style:{bottom:"max(1.5rem, calc(1.5rem + var(--safe-area-inset-bottom)))",right:"max(1.5rem, calc(1.5rem + var(--safe-area-inset-right)))"},children:[(0,r.jsx)(c.f5,{className:"h-6 w-6"}),(0,r.jsx)("span",{className:"sr-only",children:"Install App"})]})}),(0,r.jsx)(w,{side:"left",children:(0,r.jsx)("p",{children:"Install app to home screen"})})]})})}var A=s(7680);let D=A.bL;A.l9;let R=A.ZL;A.bm;let O=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,r.jsx)(A.hJ,{ref:t,className:(0,u.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...i})});O.displayName=A.hJ.displayName;let M=i.forwardRef((e,t)=>{let{className:s,children:i,...n}=e;return(0,r.jsxs)(R,{children:[(0,r.jsx)(O,{}),(0,r.jsxs)(A.UC,{ref:t,className:(0,u.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...n,children:[i,(0,r.jsxs)(A.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(c.X,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});M.displayName=A.UC.displayName;let z=e=>{let{className:t,...s}=e;return(0,r.jsx)("div",{className:(0,u.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};z.displayName="DialogHeader";let P=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,r.jsx)(A.hE,{ref:t,className:(0,u.cn)("text-lg font-semibold leading-none tracking-tight",s),...i})});P.displayName=A.hE.displayName;let L=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,r.jsx)(A.VY,{ref:t,className:(0,u.cn)("text-sm text-muted-foreground",s),...i})});function _(e){let{open:t,onOpenChange:s}=e,[n,a]=(0,i.useState)(null),[o,d]=(0,i.useState)("other");(0,i.useEffect)(()=>{{let e=window.navigator.userAgent.toLowerCase();/iphone|ipad|ipod/.test(e)?d("ios"):/android/.test(e)?d("android"):d("other")}},[]);let u=e=>{a(e)};return(0,r.jsx)(D,{open:t,onOpenChange:s,children:(0,r.jsx)(M,{className:"sm:max-w-md",children:null===n?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(z,{children:[(0,r.jsx)("div",{className:"flex justify-center mb-4",children:(0,r.jsx)(c.f5,{className:"h-12 w-12 text-foreground"})}),(0,r.jsx)(P,{className:"text-center",children:"Install Care Kit"}),(0,r.jsx)(L,{className:"text-center",children:"Select your device type to see installation instructions."})]}),(0,r.jsxs)("div",{className:"space-y-2.5 mt-4",children:[(0,r.jsx)(l.$,{onClick:()=>u("ios"),variant:"outline",size:"sm",className:"w-full border-foreground/20 hover:bg-foreground/5 hover:border-foreground/40",children:"iOS"}),(0,r.jsx)(l.$,{onClick:()=>u("android"),variant:"outline",size:"sm",className:"w-full border-foreground/20 hover:bg-foreground/5 hover:border-foreground/40",children:"Android"}),(0,r.jsx)(l.$,{onClick:()=>u("other"),variant:"outline",size:"sm",className:"w-full border-foreground/20 hover:bg-foreground/5 hover:border-foreground/40",children:"Other"})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(z,{children:[(0,r.jsx)("div",{className:"flex justify-center mb-4",children:(0,r.jsx)(c.f5,{className:"h-12 w-12 text-foreground"})}),(0,r.jsx)(P,{className:"text-center",children:"Installation Instructions"}),(0,r.jsxs)(L,{children:["ios"===n&&(0,r.jsxs)("div",{className:"text-left space-y-2 mt-4",children:[(0,r.jsx)("p",{className:"font-medium",children:"On iPhone/iPad:"}),(0,r.jsxs)("ol",{className:"list-decimal list-inside space-y-2 ml-2 text-sm",children:[(0,r.jsxs)("li",{children:["Tap the ",(0,r.jsx)("strong",{children:"Share"})," button (square with arrow up)"]}),(0,r.jsxs)("li",{children:["Scroll down and tap ",(0,r.jsx)("strong",{children:"Add to Home Screen"})]}),(0,r.jsxs)("li",{children:["Tap ",(0,r.jsx)("strong",{children:"Add"})," in the top right corner"]})]})]}),"android"===n&&(0,r.jsxs)("div",{className:"text-left space-y-2 mt-4",children:[(0,r.jsx)("p",{className:"font-medium",children:"On Android:"}),(0,r.jsxs)("ol",{className:"list-decimal list-inside space-y-2 ml-2 text-sm",children:[(0,r.jsxs)("li",{children:["Tap the ",(0,r.jsx)("strong",{children:"three dots"})," menu (⋮)"]}),(0,r.jsxs)("li",{children:["Tap ",(0,r.jsx)("strong",{children:"Add to Home screen"})," or ",(0,r.jsx)("strong",{children:"Install app"})]}),(0,r.jsxs)("li",{children:["Tap ",(0,r.jsx)("strong",{children:"Add"})," or ",(0,r.jsx)("strong",{children:"Install"})]})]})]}),"other"===n&&(0,r.jsxs)("div",{className:"text-left space-y-2 mt-4",children:[(0,r.jsx)("p",{className:"text-sm",children:"Use your browser's menu to install this app to your desktop or device."}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Look for an install or add to home screen option in your browser's settings menu."})]})]})]}),(0,r.jsxs)("div",{className:"space-y-2.5 mt-4",children:[(0,r.jsx)(l.$,{onClick:()=>{a(null)},variant:"outline",size:"sm",className:"w-full border-foreground/20 hover:bg-foreground/5 hover:border-foreground/40",children:"← Back to Platform Selection"}),(0,r.jsx)(l.$,{onClick:()=>s(!1),size:"sm",className:"w-full",children:"Got it"})]})]})})})}function B(){let{user:e,loading:t,logout:s}=(0,a.A)(),u=(0,n.useRouter)(),{toast:p}=(0,m.dj)(),[k,C]=(0,i.useState)("idle"),[E,A]=(0,i.useState)({pre:null,post:null}),[D,R]=(0,i.useState)(""),[O,M]=(0,i.useState)(null),[z,P]=(0,i.useState)(null),[L,B]=(0,i.useState)(!1),[$,W]=(0,i.useState)(null),[F,U]=(0,i.useState)(!1),Y=(0,o.h)(),[Z,H]=(0,i.useState)(null),[q,J]=(0,i.useState)(null),[V,K]=(0,i.useState)(null);(0,i.useEffect)(()=>{t||e||(console.log("No user found, redirecting to login"),u.push("/login"))},[e,t,u]),(0,i.useEffect)(()=>{let e=setTimeout(()=>{t&&(console.warn("Loading timeout - forcing redirect to login"),u.push("/login"))},5e3);return()=>clearTimeout(e)},[t,u]),(0,i.useEffect)(()=>{if(B(!0),P(new Date().getHours()),(null==e?void 0:e.studyStartDate)&&(W((0,S.Mm)(e.studyStartDate)),!e.hasCompletedStudy&&(0,S._n)(e.studyStartDate))){let t=(0,j.doc)(b.db,"users",e.uid);(0,j.updateDoc)(t,{hasCompletedStudy:!0}).catch(e=>{console.error("Error updating hasCompletedStudy flag:",e)})}},[e]);let G=t=>{if(!(null==e?void 0:e.studyStartDate))return void p({title:"Error",description:"Study start date not found. Please contact support.",variant:"destructive"});R(g[(0,S.Bj)(e.studyStartDate,"morning"===t)]),M(t),H(new Date),C("pre-stress")},Q=async t=>{if(!e)return void p({title:"Error",description:"You must be logged in to save stress data.",variant:"destructive"});if(null===E.pre||!O)return void p({title:"Error",description:"Could not save your response due to missing pre-stress data or affirmation type.",variant:"destructive"});if(!Z||!q||!V)return void p({title:"Error",description:"Could not save your response due to missing time tracking data.",variant:"destructive"});let s=new Date,r=Math.round((V.getTime()-q.getTime())/1e3),i=Math.round((s.getTime()-Z.getTime())/1e3),n={creatorId:e.uid,affirmationType:O,affirmation:D,stressBefore:E.pre,stressAfter:t,timestamp:new Date().toISOString(),flowStartTime:Z.toISOString(),affirmationStartTime:q.toISOString(),affirmationEndTime:V.toISOString(),flowEndTime:s.toISOString(),affirmationDurationSeconds:r,totalFlowDurationSeconds:i};A({pre:E.pre,post:t});try{let e=await N(n);e.success?(console.log("Stress data successfully saved!"),p({title:"Stress data saved!",description:"Your stress data has been successfully recorded."}),C("complete")):(console.error("Error saving stress data:",e.error),p({title:"Error",description:"Could not save your response: ".concat(e.error),variant:"destructive"}))}catch(e){console.error("Error saving stress data:",e),p({title:"Error",description:"An unexpected error occurred. Please try again.",variant:"destructive"})}};if(t||!e||!L)return(0,r.jsx)("div",{className:"flex h-full items-center justify-center bg-background",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 border-4 border-dashed rounded-full animate-spin border-primary-foreground mx-auto"}),(0,r.jsx)("p",{className:"mt-4 text-muted-foreground",children:"Loading..."})]})});let X=null===z||z<18;return(0,r.jsxs)("div",{className:"flex flex-col min-h-screen bg-background",children:[(0,r.jsxs)("header",{className:"p-4 flex justify-between items-center border-b",style:{paddingTop:"max(1rem, var(--safe-area-inset-top))",paddingLeft:"max(1rem, var(--safe-area-inset-left))",paddingRight:"max(1rem, var(--safe-area-inset-right))"},children:[(0,r.jsx)("h1",{className:"text-xl font-headline font-bold",children:"care-kit"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[Y&&(0,r.jsxs)(l.$,{variant:"outline",size:"sm",onClick:()=>u.push("/admin"),className:"gap-2",children:[(0,r.jsx)(c.ek,{className:"h-4 w-4"}),"Admin"]}),(0,r.jsxs)(l.$,{variant:"ghost",size:"icon",onClick:()=>U(!0),children:[(0,r.jsx)(c.sn,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Installation guide"})]}),(0,r.jsx)(T,{}),(0,r.jsx)("div",{className:"text-right text-sm",children:(0,r.jsx)("div",{children:e.email})}),(0,r.jsxs)(l.$,{variant:"ghost",size:"icon",onClick:()=>{s(),u.push("/login")},children:[(0,r.jsx)(c.nU,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Log out"})]})]})]}),(0,r.jsx)("main",{className:"flex-grow flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"w-full max-w-md",children:["idle"===k&&(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(d.Zp,{className:"shadow-lg",children:[(0,r.jsxs)(d.aR,{children:[(0,r.jsx)(d.ZB,{className:"font-headline text-center",children:"Ready for your affirmation?"}),(0,r.jsx)(d.BT,{className:"text-center",children:"You would normally receive a notification for these."})]}),(0,r.jsxs)(d.Wu,{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)(l.$,{size:"lg",onClick:()=>G("morning"),children:[(0,r.jsx)(c.mO,{className:"mr-2 h-5 w-5"}),"Morning"]}),(0,r.jsx)(x,{children:(0,r.jsxs)(v,{children:[(0,r.jsx)(y,{asChild:!0,children:(0,r.jsx)("div",{className:"w-full",children:(0,r.jsxs)(l.$,{size:"lg",onClick:()=>G("evening"),disabled:X,className:"w-full",children:[X?(0,r.jsx)(c.c_,{className:"mr-2 h-5 w-5"}):(0,r.jsx)(c.dB,{className:"mr-2 h-5 w-5"}),"Evening"]})})}),X&&(0,r.jsx)(w,{children:(0,r.jsx)("p",{children:"Evening affirmation unlocks at 6 PM."})})]})})]})]})}),"pre-stress"===k&&(0,r.jsx)(f,{title:"Before we begin, how are you feeling?",description:"Rate your current stress level from 1 (very calm) to 5 (very stressed).",onSubmit:e=>{A({...E,pre:e}),J(new Date),C("affirmation")}}),"affirmation"===k&&(0,r.jsx)(h,{affirmation:D,onContinue:()=>{K(new Date),C("post-stress")}}),"post-stress"===k&&(0,r.jsx)(f,{title:"How are you feeling now?",description:"Please rate your current stress level again.",onSubmit:Q}),"complete"===k&&(0,r.jsxs)(d.Zp,{className:"shadow-lg text-center",children:[(0,r.jsxs)(d.aR,{children:[(0,r.jsx)(d.ZB,{className:"font-headline",children:"Thank you!"}),(0,r.jsx)(d.BT,{children:"Your response has been recorded. Your participation is greatly appreciated."})]}),(0,r.jsx)(d.Wu,{children:(0,r.jsxs)(l.$,{onClick:()=>{C("idle"),A({pre:null,post:null}),M(null),H(null),J(null),K(null)},children:["Back to Dashboard ",(0,r.jsx)(c.Qp,{className:"ml-2 h-4 w-4"})]})})]})]})}),(0,r.jsx)(I,{}),(0,r.jsx)(_,{open:F,onOpenChange:U})]})}L.displayName=A.VY.displayName},4779:(e,t,s)=>{"use strict";s.d(t,{$J:()=>a,Lx:()=>o,mT:()=>n});var r=s(996),i=s(6104);async function n(){try{if(!await (0,r.TT)())return console.log("Firebase Messaging is not supported in this browser"),null;let e=await Notification.requestPermission();if("granted"===e){if(console.log("Notification permission granted."),"serviceWorker"in navigator)for(let e of(await navigator.serviceWorker.getRegistrations()))console.log("Unregistering existing service worker:",e.scope),await e.unregister();if(await new Promise(e=>setTimeout(e,500)),"serviceWorker"in navigator)try{let e=await navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/"});console.log("Service Worker registered:",e),e.installing&&await new Promise(t=>{e.installing.addEventListener("statechange",function(){"activated"===this.state&&t(null)})}),await navigator.serviceWorker.ready,console.log("Service Worker is ready")}catch(e){return console.error("Service Worker registration failed:",e),null}let e=(0,r.dG)(i.y),t=null,s=0;for(;!t&&s<3;)try{if(t=await (0,r.gf)(e,{vapidKey:"BAflMYuUiIVjaCaCxmVmwYp8801GpsUz5ic5hLsymTpnZEr2DrnHfwL7PLdPpi84JY8QKRqcl2bNqJtnbEFRpm0",serviceWorkerRegistration:await navigator.serviceWorker.ready})){console.log("FCM Token obtained successfully");break}}catch(e){if(s++,console.warn("Token retrieval attempt ".concat(s,"/").concat(3," failed:"),e.message),s<3)await new Promise(e=>setTimeout(e,1e3*s));else throw e}if(t)return console.log("FCM Token:",t),t;return console.log("No registration token available. Check service worker registration."),null}if("denied"===e)return console.log("Notification permission denied."),null;return console.log("Notification permission not granted yet."),null}catch(e){return console.error("An error occurred while requesting notification permission:",e),null}}async function a(e){try{if(!await (0,r.TT)())return void console.log("Firebase Messaging is not supported");let t=(0,r.dG)(i.y);(0,r.xD)(t,t=>{if(console.log("Message received in foreground:",t),t.notification){let e=t.notification.title||"BRAIN KIT",s={body:t.notification.body||"You have a new notification",icon:"/brain-kit-capacitor-logo.png",badge:"/brain-kit-capacitor-logo.png",tag:"brain-kit-notification",requireInteraction:!1,vibrate:[200,100,200],data:t.data||{},silent:!1},r=new Notification(e,s);r.onclick=e=>{var s;e.preventDefault(),window.focus(),r.close(),(null==(s=t.data)?void 0:s.url)&&(window.location.href=t.data.url)},console.log("System tray notification shown in foreground")}e(t)})}catch(e){console.error("Error setting up message listener:",e)}}async function o(e,t){try{let{db:r}=await Promise.resolve().then(s.bind(s,6104)),{doc:i,updateDoc:n,arrayUnion:a}=await Promise.resolve().then(s.bind(s,5317)),o=i(r,"users",e);await n(o,{fcmTokens:a(t),lastTokenUpdate:new Date().toISOString()}),console.log("FCM token saved to user document")}catch(e){console.error("Error saving FCM token:",e)}}},6695:(e,t,s)=>{"use strict";s.d(t,{BT:()=>d,Wu:()=>c,ZB:()=>l,Zp:()=>a,aR:()=>o,wL:()=>u});var r=s(5155),i=s(2115),n=s(9434);let a=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...i})});a.displayName="Card";let o=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",s),...i})});o.displayName="CardHeader";let l=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",s),...i})});l.displayName="CardTitle";let d=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",s),...i})});d.displayName="CardDescription";let c=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",s),...i})});c.displayName="CardContent";let u=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",s),...i})});u.displayName="CardFooter"},7481:(e,t,s)=>{"use strict";s.d(t,{dj:()=>m});var r=s(2115);let i=0,n=new Map,a=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},o=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?a(s):e.toasts.forEach(e=>{a(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},l=[],d={toasts:[]};function c(e){d=o(d,e),l.forEach(e=>{e(d)})}function u(e){let{...t}=e,s=(i=(i+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>c({type:"DISMISS_TOAST",toastId:s});return c({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||r()}}}),{id:s,dismiss:r,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function m(){let[e,t]=r.useState(d);return r.useEffect(()=>(l.push(t),()=>{let e=l.indexOf(t);e>-1&&l.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},8317:(e,t,s)=>{Promise.resolve().then(s.bind(s,1856))},9229:(e,t,s)=>{"use strict";function r(e){let t=new Date(e),s=new Date;return t.setHours(0,0,0,0),s.setHours(0,0,0,0),Math.floor((s.getTime()-t.getTime())/864e5)+1}function i(e,t){return(r(e)-1)%7*2+ +!t}function n(e){return r(e)>=7}s.d(t,{Bj:()=>i,Mm:()=>r,_n:()=>n})},9298:(e,t,s)=>{"use strict";s.d(t,{h:()=>i});var r=s(9576);function i(){let{user:e}=(0,r.A)();return(null==e?void 0:e.role)==="admin"}}},e=>{var t=t=>e(e.s=t);e.O(0,[992,644,633,366,786,985,942,441,684,358],()=>t(8317)),_N_E=e.O()}]);