"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[103],{535:(e,t,r)=>{r.d(t,{O:()=>u,A:()=>w});var o=r(5155),s=r(2115),n=r(5317),i=r(6104);let a=(0,n.doc)(i.db,"counters","participantId");async function d(){try{let e=await (0,n.c4)(i.db,async e=>{let t,r=await e.get(a);return t=r.exists()?r.data().count+1:2025001,e.set(a,{count:t}),t});return"P".concat(e)}catch(e){return console.error("Transaction failed: ",e),null}}var l=r(3004);let h=(0,s.createContext)(void 0),c=(0,l.getAuth)(i.y);function u(e){let{children:t}=e,[r,a]=(0,s.useState)(null),[u,w]=(0,s.useState)(!0);(0,s.useEffect)(()=>{let e=(0,l.onAuthStateChanged)(c,async e=>{if(console.log("onAuthStateChanged triggered, user:",null==e?void 0:e.uid),e){let t=(0,n.doc)(i.db,"users",e.uid);console.log("Fetching user document...");let r=await (0,n.x7)(t),o=0;for(;!r.exists()&&o<5;)console.log("User document not found, retry ".concat(o+1,"/").concat(5,"...")),await new Promise(e=>setTimeout(e,500)),r=await (0,n.x7)(t),o++;if(r.exists()){console.log("User document found, setting user state");let t=r.data();a({email:e.email,uid:e.uid,participantId:t.participantId,role:t.role||"user",memorableCodeWord:t.memorableCodeWord,studyStartDate:t.studyStartDate,hasCompletedStudy:t.hasCompletedStudy||!1})}else console.error("User document not found after retries"),await (0,l.signOut)(c),a(null)}else console.log("No authenticated user"),a(null);console.log("Setting loading to false"),w(!1)});return()=>e()},[]);let p=async(e,t)=>{await (0,l.signInWithEmailAndPassword)(c,e,t)},g=async(e,t)=>{let r=null;try{console.log("Starting signup process..."),r=(await (0,l.createUserWithEmailAndPassword)(c,e,t)).user,console.log("Firebase user created:",r.uid),console.log("Generating participant ID...");let o=await d();if(console.log("Participant ID generated:",o),o){let e=(0,n.doc)(i.db,"users",r.uid);return console.log("Creating user document..."),await (0,n.BN)(e,{email:r.email,participantId:o,role:"user",studyStartDate:new Date().toISOString(),hasCompletedStudy:!1}),console.log("User document created successfully"),o}throw Error("Failed to generate participant ID.")}catch(o){if(console.error("Signup error:",o),r)try{console.log("Cleaning up failed signup..."),await (0,l.signInWithEmailAndPassword)(c,e,t),await (0,l.deleteUser)(c.currentUser),console.log("User cleaned up")}catch(e){console.error("Failed to clean up user during signup failure:",e)}throw o}},x=async()=>{await (0,l.signOut)(c)},j=async()=>{let e=new l.GoogleAuthProvider;try{let t=(await (0,l.signInWithPopup)(c,e)).user,r=(0,n.doc)(i.db,"users",t.uid);if(!(await (0,n.x7)(r)).exists()){let e=await d();if(e)await (0,n.BN)(r,{email:t.email,participantId:e,authProvider:"google",role:"user",studyStartDate:new Date().toISOString(),hasCompletedStudy:!1});else throw Error("Failed to generate participant ID.")}}catch(e){throw console.error("Google sign-in error:",e),e}},m=async e=>{await (0,l.sendPasswordResetEmail)(c,e)},k=async(e,t)=>{let o=(0,n.doc)(i.db,"users",e);await (0,n.BN)(o,{memorableCodeWord:t},{merge:!0}),r&&a({...r,memorableCodeWord:t})};return(0,o.jsx)(h.Provider,{value:{user:r,loading:u,login:p,signup:g,signInWithGoogle:j,logout:x,sendPasswordReset:m,saveMemorableCodeWord:k},children:t})}function w(){let e=(0,s.useContext)(h);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},3262:(e,t,r)=>{r.d(t,{B1:()=>n,Ir:()=>g,Ot:()=>d,Qp:()=>s,Wm:()=>u,X:()=>p,br:()=>x,c_:()=>i,dB:()=>c,ek:()=>l,f5:()=>w,mO:()=>h,nU:()=>a});var o=r(5155);let s=e=>(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,children:[(0,o.jsx)("path",{d:"M5 12h14"}),(0,o.jsx)("path",{d:"m12 5 7 7-7 7"})]}),n=e=>(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,children:(0,o.jsx)("path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"})}),i=e=>(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,children:[(0,o.jsx)("rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2"}),(0,o.jsx)("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]}),a=e=>(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,children:[(0,o.jsx)("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),(0,o.jsx)("polyline",{points:"16 17 21 12 16 7"}),(0,o.jsx)("line",{x1:"21",x2:"9",y1:"12",y2:"12"})]}),d=e=>(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,children:[(0,o.jsx)("path",{d:"M22 13V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h8"}),(0,o.jsx)("path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"}),(0,o.jsx)("path",{d:"m16 19 2 2 4-4"})]}),l=e=>(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,children:(0,o.jsx)("path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"})}),h=e=>(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,children:[(0,o.jsx)("path",{d:"M12 2v8"}),(0,o.jsx)("path",{d:"m4.93 10.93 1.41 1.41"}),(0,o.jsx)("path",{d:"M2 18h2"}),(0,o.jsx)("path",{d:"M20 18h2"}),(0,o.jsx)("path",{d:"m19.07 10.93-1.41 1.41"}),(0,o.jsx)("path",{d:"M22 22H2"}),(0,o.jsx)("path",{d:"m8 6 4-4 4 4"}),(0,o.jsx)("path",{d:"M16 18a4 4 0 0 0-8 0"})]}),c=e=>(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,children:[(0,o.jsx)("path",{d:"M12 10V2"}),(0,o.jsx)("path",{d:"m4.93 10.93 1.41 1.41"}),(0,o.jsx)("path",{d:"M2 18h2"}),(0,o.jsx)("path",{d:"M20 18h2"}),(0,o.jsx)("path",{d:"m19.07 10.93-1.41 1.41"}),(0,o.jsx)("path",{d:"M22 22H2"}),(0,o.jsx)("path",{d:"m16 6-4 4-4-4"}),(0,o.jsx)("path",{d:"M16 18a4 4 0 0 0-8 0"})]}),u=e=>(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,children:[(0,o.jsx)("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}),(0,o.jsx)("path",{d:"M3 5v14c0 1.7 4 3 9 3s9-1.3 9-3V5"}),(0,o.jsx)("path",{d:"M3 12c0 1.7 4 3 9 3s9-1.3 9-3"})]}),w=e=>(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,children:[(0,o.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,o.jsx)("polyline",{points:"7 10 12 15 17 10"}),(0,o.jsx)("line",{x1:"12",x2:"12",y1:"15",y2:"3"})]}),p=e=>(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,children:[(0,o.jsx)("path",{d:"M18 6 6 18"}),(0,o.jsx)("path",{d:"m6 6 12 12"})]}),g=e=>(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,children:[(0,o.jsx)("path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"}),(0,o.jsx)("path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0"})]}),x=e=>(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,children:[(0,o.jsx)("path",{d:"M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5"}),(0,o.jsx)("path",{d:"M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7"}),(0,o.jsx)("path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0"}),(0,o.jsx)("path",{d:"m2 2 20 20"})]})},6104:(e,t,r)=>{r.d(t,{db:()=>a,y:()=>i});var o=r(3915),s=r(5317),n=r(996);let i=(0,o.Dk)().length?(0,o.Sx)():(0,o.Wp)({apiKey:"AIzaSyDrqE9PM1N7EdxHCwTeDi-o2Tq17hXmrlA",authDomain:"brain-kit-prod.firebaseapp.com",projectId:"brain-kit-prod",storageBucket:"brain-kit-prod.firebasestorage.app",messagingSenderId:"16172690806",appId:"1:16172690806:web:aa9ca0f694733b23d29e57",measurementId:"G-BVQ16YPJRS"}),a=(0,s.aU)(i);(0,n.TT)().then(e=>{e&&(0,n.dG)(i)})},9434:(e,t,r)=>{r.d(t,{cn:()=>n});var o=r(2596),s=r(9688);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,o.$)(t))}}}]);